{"ast":null,"code":"import { postBySlugQuery } from '../../lib/queries';\nimport { previewClient } from '../../lib/sanity.server';\nexport default async function preview(req, res) {\n  // Check the secret and next parameters\n  // This secret should only be known to this API route and the CMS\n  if (req.query.secret !== process.env.SANITY_PREVIEW_SECRET || !req.query.slug) {\n    return res.status(401).json({\n      message: 'Invalid token'\n    });\n  } // Check if the post with the given `slug` exists\n\n\n  const post = await previewClient.fetch(postBySlugQuery, {\n    slug: req.query.slug\n  }); // If the slug doesn't exist prevent preview mode from being enabled\n\n  if (!post) {\n    return res.status(401).json({\n      message: 'Invalid slug'\n    });\n  } // Enable Preview Mode by setting the cookies\n\n\n  res.setPreviewData({}); // Redirect to the path from the fetched post\n  // We don't redirect to req.query.slug as that might lead to open redirect vulnerabilities\n\n  res.writeHead(307, {\n    Location: `/posts/${post.slug}`\n  });\n  res.end();\n}","map":{"version":3,"sources":["/home/anomy/Documents/nextjs-projects/yazbana/client/pages/api/preview.js"],"names":["postBySlugQuery","previewClient","preview","req","res","query","secret","process","env","SANITY_PREVIEW_SECRET","slug","status","json","message","post","fetch","setPreviewData","writeHead","Location","end"],"mappings":"AAAA,SAASA,eAAT,QAAgC,mBAAhC;AACA,SAASC,aAAT,QAA8B,yBAA9B;AAEA,eAAe,eAAeC,OAAf,CAAuBC,GAAvB,EAA4BC,GAA5B,EAAiC;AAC9C;AACA;AACA,MAAID,GAAG,CAACE,KAAJ,CAAUC,MAAV,KAAqBC,OAAO,CAACC,GAAR,CAAYC,qBAAjC,IAA0D,CAACN,GAAG,CAACE,KAAJ,CAAUK,IAAzE,EAA+E;AAC7E,WAAON,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,MAAAA,OAAO,EAAE;AAAX,KAArB,CAAP;AACD,GAL6C,CAO9C;;;AACA,QAAMC,IAAI,GAAG,MAAMb,aAAa,CAACc,KAAd,CAAoBf,eAApB,EAAqC;AACtDU,IAAAA,IAAI,EAAEP,GAAG,CAACE,KAAJ,CAAUK;AADsC,GAArC,CAAnB,CAR8C,CAY9C;;AACA,MAAI,CAACI,IAAL,EAAW;AACT,WAAOV,GAAG,CAACO,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AAAEC,MAAAA,OAAO,EAAE;AAAX,KAArB,CAAP;AACD,GAf6C,CAiB9C;;;AACAT,EAAAA,GAAG,CAACY,cAAJ,CAAmB,EAAnB,EAlB8C,CAoB9C;AACA;;AACAZ,EAAAA,GAAG,CAACa,SAAJ,CAAc,GAAd,EAAmB;AAAEC,IAAAA,QAAQ,EAAG,UAASJ,IAAI,CAACJ,IAAK;AAAhC,GAAnB;AACAN,EAAAA,GAAG,CAACe,GAAJ;AACD","sourcesContent":["import { postBySlugQuery } from '../../lib/queries';\nimport { previewClient } from '../../lib/sanity.server';\n\nexport default async function preview(req, res) {\n  // Check the secret and next parameters\n  // This secret should only be known to this API route and the CMS\n  if (req.query.secret !== process.env.SANITY_PREVIEW_SECRET || !req.query.slug) {\n    return res.status(401).json({ message: 'Invalid token' });\n  }\n\n  // Check if the post with the given `slug` exists\n  const post = await previewClient.fetch(postBySlugQuery, {\n    slug: req.query.slug,\n  });\n\n  // If the slug doesn't exist prevent preview mode from being enabled\n  if (!post) {\n    return res.status(401).json({ message: 'Invalid slug' });\n  }\n\n  // Enable Preview Mode by setting the cookies\n  res.setPreviewData({});\n\n  // Redirect to the path from the fetched post\n  // We don't redirect to req.query.slug as that might lead to open redirect vulnerabilities\n  res.writeHead(307, { Location: `/posts/${post.slug}` });\n  res.end();\n}\n"]},"metadata":{},"sourceType":"module"}